# <center> Lecture 7 Note

## 一、 着色 (Shading)
在完成了模型、视图、投影变换（MVP）以及光栅化之后，我们已经知道了物体应该被画在屏幕的哪个位置。着色的核心任务是：计算在光照下，物体表面应该呈现出什么样的明暗与颜色。

- **着色 (Shading)** 是将一种**材质 (Material)** 应用于一个物体的过程。

通过模拟光线与物体表面的交互，着色可以极大地提升场景的真实感和立体感。

## 二、 Blinn-Phong 反射模型
该模型通过观察真实世界的光照现象，将其分解为三个主要部分：

- **高光 (Specular highlights)**: 在光滑表面上，由光源直接反射形成的明亮光斑。

- **漫反射 (Diffuse reflection)**: 光线被物体表面向各个方向均匀散射，构成了物体本身的基础颜色和明暗。

- **环境光 (Ambient lighting)**: 来自环境中其他物体间接反弹过来的光，用于照亮场景中的阴影部分，避免其完全变黑。

## 三、 局部光照模型 (Local Illumination)
Blinn-Phong模型是一种局部光照模型，意味着在计算某一个点（Shading Point）的颜色时，我们只考虑该点自身的信息，**不考虑其他物体的遮挡**。

要计算一个着色点的颜色，我们需要定义以下几个关键的单位向量：

- $\vec{n}$: 着色点所在表面的**法线 (normal)** 方向。

- $\vec{v}$: 从着色点指向**观察者 (viewer)** / 相机的方向。

- $\vec{l}$: 从着色点指向**光源 (light)** 的方向。

- **表面参数**: 物体的材质属性，如颜色、粗糙度、高光强度等。

**注意**: 在局部光照模型中，我们不会计算由场景中其他物体投射过来的阴影 (Shadows)。

## 四、 漫反射 (Diffuse Reflection)
漫反射是构成物体颜色和明暗的基础。

### 1. 核心特性
- **均匀散射**: 当光线到达一个理想的漫反射表面（也称兰伯特表面）时，它会向所有方向进行均匀的散射。

- **与观察方向无关**: 因为光线是均匀散射的，所以无论观察者从哪个角度（向量$\vec{v}$）看，看到的颜色都是一样的。

### 2. 兰伯特定律 (Lambert's Cosine Law)

- **内容**: 表面单位面积接收到的能量，正比于光线方向 $\vec{l}$ 与表面法线 $\vec{n}$ 之间夹角 $θ$ 的余弦值。

- **几何解释**: 当光线垂直照射($θ$=0)时，单位面积接收的能量最多。当光线与表面平行($θ$=90°) 或从背面照射时，接收能量为0。

- **数学表示**:$能量接收因子=max(0,cosθ)=max(0,n⋅l)$
    使用 $max(0, ...) 是为了确保从表面背面来的光(n·l < 0)$不会产生负的光照效果。

### 3. 光的衰减 (Light Falloff)
对于一个点光源，其发出的光在三维空间中向所有方向传播。根据能量守恒定律，随着距离的增加，光的强度会衰减。

**衰减规律**: 在距离点光源 r 处，光的强度与距离的平方成**反比**。即$到达强度= \frac{I}{r^2}$
​
 
### 4. 漫反射最终公式
综合以上所有因素，我们可以得出漫反射光照的最终计算公式：
$$L_d = k_d \cdot (\frac{I}{r^2}) \cdot max(0, n \cdot l)$$
​
- $L_d$: 漫反射光照的颜色和强度。
- $k_d$: 漫反射系数 (diffuse coefficient)。它代表了物体表面的颜色和反射率（一个0到1之间的值）。对于彩色物体，$k_d$ 是一个RGB向量，它决定了物体对不同颜色的光的吸收和反射比例。
- $\frac{I}{r^2}$: 到达着色点的光的能量和颜色。
- $max(0,n⋅l)$: 着色点实际接收到的能量比例。
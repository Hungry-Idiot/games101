# <center> Lecture 5 Note

## 一、定义透视投影的视锥
在实际应用中，通常不直接定义近裁剪平面的left, right, bottom, top，而是使用更直观的参数来定义透视投影的视锥体 (Frustum)：

1. **垂直可视角度 (Vertical Field-of-View, fovY)**: 相机垂直方向的张开角度。

2. **宽高比 (Aspect Ratio)**: 屏幕的 width / height。

通过这两个参数和近平面距离 n，可以推导出 top 和 right 的值：

$$ 
t = |n| \cdot \tan(\frac{fovY}{2}) \\
r = t \cdot \text{aspect} 
$$

## 二、 定义屏幕：光栅与像素
### 1. 屏幕
**屏幕 (Screen)**：屏幕可以被抽象为一个二维数组，数组的每个元素就是一个像素 (Pixel)。

**光栅 (Raster)**：光栅化 (Rasterize) 就是指将物体绘制到屏幕上的过程。

**像素 (Pixel)**：Picture Element的缩写，是图像的最小单位。在本课程中，将其简化为一个具有统一颜色（由R, G, B混合）的小方块。

### 2. 屏幕坐标系
**原点**：屏幕左下角为 (0, 0)。

**像素索引**：像素的坐标用整数 (x, y) 表示，范围从 (0, 0) 到 (width-1, height-1)。

**像素中心**：像素 (x, y) 的中心点坐标为 (x+0.5, y+0.5)。

### 3. 光栅化核心
光栅化的核心任务，就是找出屏幕上的哪些像素被给定的三角形所覆盖。

#### 为什么是三角形？
   1. 三角形是图形学中最基础、最重要的图元，因为它有许多优良特性：

   2. 最基本的多边形：任何复杂的多边形都可以被拆分成若干个三角形。

   3. 保证平面性：三个顶点必然定义一个唯一的平面。

   4. 内外定义清晰：很容易判断一个点是在三角形内部还是外部。

   5. 便于插值：可以通过“重心坐标”在三角形内部平滑地插值顶点属性（如颜色、法线、纹理坐标等）。

## 三、 光栅化的本质：采样 (Sampling)
如何判断一个像素是否被三角形覆盖？最简单的方法就是采样。

### 1. 采样：可以理解为在一个连续的函数上，取离散的点来近似表示这个函数。

在三角形光栅化中，我们用每个像素的中心点 (x+0.5, y+0.5) 去进行采样，判断这个中心点是否落在三角形内部。

```C++
// 伪代码：遍历所有像素进行采样
for (int x = 0; x < width; ++x) {
    for (int y = 0; y < height; ++y) {
        // 判断像素中心点 (x+0.5, y+0.5) 是否在三角形内
        if (inside(triangle, x + 0.5, y + 0.5)) {
            // 如果在，就给这个像素上色
            image[x][y] = triangle_color;
        }
    }
}
```
我们可以使用**向量叉乘 (Cross Product)** 来高效地判断一个点是否在三角形内部。

### 2. 加速光栅化：包围盒 (Bounding Box)
遍历屏幕上的所有像素效率很低。一个简单的优化方法是，只遍历该三角形的轴对齐包围盒 (Axis-Aligned Bounding Box, AABB) 范围内的像素。

做法：找到三角形三个顶点的 x_min, x_max, y_min, y_max，只在这个矩形区域内进行采样测试。

特殊情况：对于特别狭长的三角形，还有更优化的逐行扫描等方法。

## 四、 初步问题：走样 (Aliasing)
通过采样来进行光栅化，会引入一个图形学中最基本、最严重的问题之一——走样 (Aliasing)。

表现：在屏幕上，物体的边缘会呈现出锯齿状，称之为 “Jaggies”。

原因：这是用离散的像素点去近似表示连续的几何形状时，由于采样率不足而产生的必然结果。